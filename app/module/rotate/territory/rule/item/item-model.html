<tr>
    <td>{{$index()+1}}</td>
    <td>
        <select class="form-control" data-bind="
                                    options: window.enums.territoryRuleProperty,
                                    optionsText: 'text',
                                    optionsValue: 'value',
                                    value: field
                                ">
        </select>
    </td>
    <td>
        <select class="form-control" data-bind="
                                    options: window.enums.ruleType,
                                    optionsText: 'text',
                                    optionsValue: 'value',
                                    value: type
                                ">
        </select>
    </td>
    <td>
        <div  data-bind="foreach:value">
            <div>
                <div style="width: 90%;display: inline-block">
                <!-- ko module: $data --><!-- /ko -->
                </div>
                <a data-bind="click:function(){$parent.value.remove($data)}" style="display: inline-block"> 删除</a>
            </div>

        </div>
        <a data-bind="click:function(){value.push(createChild())}">添加</a>
    </td>
    <td>
        <div class="btn-group">
            <a class="btn btn-link" data-bind="click:function(){$parents[1].items.remove($data)}">删除</a>
        </div>
    </td>
</tr>
<script>
    var Select = require('module/control/select');
    var ko = require('knockout');
    model = [
        function () {
            this.setData({
                field:'type',
                type:1,
                value:[]
            });
            var setData = this.setData;
            this.setData = function(data1){
                var value = data1.value;
                delete data1.value;
                setData.call(this,data1);
                var self = this;
                this.value(value.map(function(child){
                    return self.createChild(child);
                }));
            }

        },{
            createChild:function(child){
                var field  = this.field();
                var a = window.enums.territoryRuleProperty.filter(function(t){
                    return t.value===field
                })[0];
                if(a.type===1){
                    return new Select({
                        options:window.enums[a.enumKey],
                        value:ko.observable(child)
                    })
                }else{
                    return new (require('module/rotate/territory/rule/item/'+field))(child);
                }
            }
        }]
</script>