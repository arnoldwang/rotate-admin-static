<div class="modal fade">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header clearfix">
               <button type="button" class="close" data-bind="click: cancel">×</button>
                <h4>{{territoryName}} - 子战区运行状态</h4>
            </div>
            <div class="modal-body">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>
                                战区名称
                            </th>
                            <th style="width: 25%">
                                开始时间
                            </th>
                            <th style="width: 25%">
                                结束时间
                            </th>
                            <th style="width: 20%">
                                运行状态
                            </th>
                            <th style="width: 10%">
                                操作
                            </th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: items,items,delegateEvent: {
                        click: {
                             '.editable': function(item) {
                             reRun(item);
                                }
                            }
                        }">
                        <tr>
                            <td>
                               {{territoryName}}                    
                            </td>
                            <td>
                                {{createTime| time}}
                            </td>
                            <td>
                                {{updateTime | time}}
                            </td>
                            <td>
                                {{runStatus|enums:'runStatus'}}
                            </td>
                            <td>
                            <span class="editable" data-bind="visible:runStatus()===4">
                            重试
                            </span> 
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    var notification = require('service/notification');

    model = [
        function () {
            this.setData({
                territoryName: null,
                items: [],
                id:null
            })
        },
        {
            onOpen: function (data, callback) {

                this.setData(data);
                this.query()
                this.callback = callback;
            },


            query:function() {
                this.fetch({
                    url: '/territory/leafHistoryList',
                    data: {
                        runHistoryId: this.id()
                    },
                    success: function (items) {
                        this.setData({
                            items: items
                        })
                    }
                })
            },
            cancel: function() {
                this.callback();
            },
            reRun: function(item) {
                if(confirm("确定重新运行嘛?")){
                    this.fetch({
                        url: '/territory/reRunTerritoryRule',
                        data: {
                            id: item.id
                        },
                        success: function () {

                            this.query()
                        }
                    });
                }
            }
        }
    ]
</script>