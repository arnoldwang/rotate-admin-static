<script>
    var ko = require('knockout');
    var Base = require('./node');
    var base = Base.prototype;

    model = [
        Base,

        function() {
            ko.computed(function() {
                this.id();
                this.resetExpandState();
            }, this);
        },

        {
            reset: function() {
                base.reset.call(this);
                this.setData({
                    __hasExpanded: false
                })
            },

            resetExpandState: function() {
                this.children.removeAll();
                this.__hasExpanded(false);
            },

            expand: function() {
                if (this.__hasExpanded()) {
                    base.expand.call(this);
                }
                else {
                    this.pipe([this.fetchChildren, this.setChildren, function() {
                        this.__hasExpanded(true);
                        base.expand.call(this);
                    }])
                }
            },

            fetchChildren: function(callback) {
                this.fetch({
                    url: this.getFetchUrl(),
                    data: this.getQueryData(),
                    success: callback
                });
            },

            // to be override
            getQueryData: function() {
            },

            // to be override
            getFetchUrl: function() {
            }
        }

        
    ]
</script>