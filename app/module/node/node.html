<script>
model = [
    function() {
        this.reset();

        if (!this.ChildNodeClass) {
            this.ChildNodeClass = this.constructor;
        }
    },
    {
        ChildNodeClass: null,

        reset: function() {
            this.setData({
                id: null,
                name: null,
                children: [],

                __expand: false
            });
        },

        expand: function() {
            this.__expand(true);
        },

        collapse: function() {
            this.__expand(false);
        },

        setChildren: function(children) {
            this.children(children.map(this.createChildNode, this))
        },

        createChildNode: function(data) {
            var child = new this.ChildNodeClass();
            var children = data.children;
            delete data.children;
            child.setData(data);
            // children要特别设置
            if (children) {
                child.setChildren(children);
            }
            return child;
        },

        cascadeParentFirst: function(fn) {
            fn(this);
            this.children().forEach(function(child) {
                child.cascadeParentFirst(fn)
            })
        },

        cascadeChildFirst: function(fn) {
            this.children().forEach(function(child) {
                child.cascadeChildFirst(fn)
            });
            fn(this);
        }
    }
]
</script>