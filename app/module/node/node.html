<div class="node">
    <div class="handle">
        <!-- ko if: children().length -->
        <i class="glyphicon glyphicon-plus" data-bind="click: expand, visible: !__expand()"></i>
        <i class="glyphicon glyphicon-minus" data-bind="click: collapse, visible: __expand"></i>
        <!-- /ko -->
    </div>
    <div>
        <div class="item" data-bind="module: item">
        </div>        
        <div class="children" data-bind="visible: __expand, foreach: children">
            <!-- ko module: $data --><!-- /ko -->
        </div>
    </div>
</div>
<script>
model = [
    function() {
        this.reset();

        if (!this.ChildClass) {
            this.ChildClass = this.constructor;
        }
    },
    {
        reset: function() {
            this.setData({
                id: null,
                name: null,
                children: [],

                __expand: false
            });
        },

        expand: function() {
            this.__expand(true);
        },

        collapse: function() {
            this.__expand(false);
        },

        setChildren: function(children) {
            this.children(children.map(this.createChildNode, this))
        },

        createChildNode: function(data) {
            var child = new this.ChildClass();
            var children = data.children;
            delete data.children;
            child.setData(data);
            // children要特别设置
            if (children) {
                child.setChildren(children);
            }
            return child;
        },

        cascadeParentFirst: function(fn) {
            fn(this);
            this.children().forEach(function(child) {
                child.cascadeParentFirst(fn)
            })
        },

        cascadeChildFirst: function(fn) {
            this.children().forEach(function(child) {
                child.cascadeChildFirst(fn)
            });
            fn(this);
        }
    }
]
</script>